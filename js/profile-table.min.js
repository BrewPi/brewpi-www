function BeerProfileTable(e,t){"use strict";if(arguments.length>0){this.init(e,t)}}BeerProfileTable.prototype={init:function(e,t){"use strict";this.id=e;this.profileName="";this.config=t||{};this.config.timeFormat="HH:mm:ss";this.selector="#"+this.id;this.menuId=this.id+"Menu";this.menuSelector="#"+this.menuId;this.bodySelector=this.selector+" tbody";this.headSelector=this.selector+" thead";this.footSelector=this.selector+" tfoot";this.rowsSelector=this.bodySelector+" tr";this.newTable='<table border="0"><thead></thead><tbody></tbody><tfoot></tfoot></table>';this.newRow="<tr></tr>";this.newCell="<td></td>";this.newHeadCell="<th></th>";this.numMilliSecondsPerDay=24*60*60*1e3;this.headerTitles=["Day","Temperature","Date and Time"];this.csvColumns=["date","temperature","days"];this.prepTable()},prepTable:function(){"use strict";var e=$(this.newTable).attr("class",this.config.tableClass);$(this.selector).append(e);$(this.headSelector).addClass(this.config.theadClass);$(this.bodySelector).addClass(this.config.tbodyClass)},render:function(e){"use strict";this.profileName=e.name;this.renderHeader();this.renderRows(e.profile);this.renderFooter();var t=this.parseStartDate(e.profile);this.updateDisplay(t)},renderHeader:function(){"use strict";if($(this.headSelector+" th").length>0){return}var e=$(this.newRow);$(this.headSelector).append(e);var t=$(this.newHeadCell).text(this.headerTitles[0]);e.append(t);t=$(this.newHeadCell).text(this.headerTitles[1]);e.append(t);t=$(this.newHeadCell).text(this.headerTitles[2]);e.append(t)},renderRows:function(e){"use strict";this.clearRows();for(var t=0;t<e.length;t++){this.renderRow(e[t])}if(this.config.editable){this.addRow()}},renderRow:function(e){"use strict";var t=this.createRow(e.days,e.temperature,e.date);$(this.bodySelector).append(t)},renderFooter:function(){},addRow:function(){"use strict";var e=this.createRow();$(this.bodySelector).append(e)},insertRow:function(e,t){"use strict";var n=this.createRow();if(t){$(this.rowsSelector).eq(e).after(n)}else{$(this.rowsSelector).eq(e).before(n)}this.updateDisplay();n.find("td.profileDays").focus()},insertRowNow:function(){"use strict";var e=(new Date).getTime();var t=e-this.getStartDate().getTime();var n=(t/this.numMilliSecondsPerDay).toFixed(2);var r=this.getProfileData();var i=r.length-1;var s="";for(var o=0;o<r.length;o++){if(parseFloat(r[o].days)>parseFloat(n)){i=o-1;break}}if(i+1<r.length){var u=parseFloat(r[i].temperature);var a=parseFloat(r[i+1].temperature);var f=parseFloat(r[i].days);var l=parseFloat(r[i+1].days);s=(u+(a-u)*(n-f)/(l-f)).toFixed(2)}var c=this.createRow(n,s);$(this.rowsSelector).eq(i).after(c);this.updateDisplay();c.find("td.profileTemp").focus()},deleteRow:function(e){"use strict";$(this.rowsSelector).eq(e).remove();var t=this;this.updateDisplay()},createRow:function(e,t,n){"use strict";var r=$(this.newRow);var i=$(this.newCell).addClass("profileDays").html(e||"");this.attachCellHandlers(i,true);r.append(i);i=$(this.newCell).addClass("profileTemp").html(t||"");this.attachCellHandlers(i,false);r.append(i);i=$(this.newCell).addClass("profileDate").html(n||"");r.append(i);this.attachRowHandlers(r);return r},attachRowHandlers:function(e){"use strict";e.bind("click",function(){$(this).addClass("selected").siblings().removeClass("selected")});var t=this;if(this.config.editable){e.bind("contextmenu",function(e){$(this).addClass("selected").siblings().removeClass("selected");var n=$(this).data("rowIndex");var r=t.createContextMenu(n);$(t.selector).append(r);t.positionMenu(e,r);r.show();if(t.config.contextMenuDisplayHandler!==null){t.config.contextMenuDisplayHandler(true)}e.preventDefault()})}},attachCellHandlers:function(e,t){"use strict";var n=this;if(this.config.editable){e.attr("contenteditable","true").focus(function(){n.selectAll(this)}).blur(function(){if(!n.preventFocusEvents){n.maintainEmptyRow();n.maintainZeroRow();n.updateDisplay()}})}},clearRows:function(){"use strict";$(this.bodySelector).empty()},createContextMenu:function(e){"use strict";if($(this.menuSelector).length){$(this.menuSelector).remove();console.log("closing already open menu")}var t=this;var n=$("<div></div>").attr("id",this.menuId).addClass(this.config.contextMenuCssClass);var r=$("<ul></ul>");var i=$("<li></li>").addClass("insertBefore").text("Insert Row Before").click(function(){t.insertRow(e,false);t.closeContextMenu()});r.append(i);i=$("<li></li>").addClass("insertAfter").text("Insert Row After").click(function(){t.insertRow(e,true);t.closeContextMenu()});r.append(i);i=$("<li></li>").addClass("delete").text("Delete Row").click(function(){t.deleteRow(e);t.closeContextMenu()});r.append(i);n.append(r);return n},positionMenu:function(e,t){"use strict";t.css("top",$(e.target).position().top+e.offsetY);t.css("left",$(e.target).position().left+e.offsetX)},closeContextMenu:function(){"use strict";$(this.menuSelector).remove();if(this.config.contextMenuDisplayHandler!==null){this.config.contextMenuDisplayHandler(false)}},updateDisplay:function(e){"use strict";var t;if(typeof e!=="undefined"){t=e;this.setStartDate(e)}else{t=this.getStartDate()}if(typeof t!=="undefined"){var n=0;$(this.rowsSelector).each(function(){$(this).data("rowIndex",n);n++});var r=$(this.rowsSelector).get();r.sort(function(e,t){var n=parseFloat($(e).find("td.profileDays").text());var r=parseFloat($(t).find("td.profileDays").text());if(isNaN(n)||isNaN(r)||n===r){return parseInt($(e).data("rowIndex"),10)-parseInt($(t).data("rowIndex"),10)}else{return n-r}});var i=0;var s=this;$.each(r,function(e,n){var r=$(n).find("td.profileDays").text();if(typeof r!=="undefined"&&r!==""){var o=s.formatNextDate(t,r);$(this).find("td.profileDate").text(o.display).data("profile-date",o.raw)}var u="even";var a="odd";if(i%2===1){u="odd";a="even"}$(n).addClass(u).removeClass(a).removeClass("selected").data("rowIndex",i);$(s.bodySelector).append(n);i++})}if(!this.hasInvalidDayCells()&&typeof this.config.chartUpdateCallBack!=="undefined"){this.config.chartUpdateCallBack()}},maintainZeroRow:function(){"use strict";var e=parseFloat($(this.rowsSelector+":first-child").find("td.profileDays").text());if(isNaN(e)){return}if(e!==0){var t=this.createRow("0","");$(this.rowsSelector).eq(0).before(t);this.updateDisplay()}},formatNextDate:function(e,t){"use strict";var n=parseFloat(t);if(isNaN(n)){return{raw:"",display:"Invalid 'Days' value"}}var r=e.getTime();var i=parseInt(this.numMilliSecondsPerDay*n,10);var s=new Date(r+i);return this.formatDate(s)},formatDate:function(e){"use strict";var t=$.datepicker.formatDate(this.config.dateFormat,e);var n=$.datepicker.formatDate(this.config.dateFormatDisplay,e);var r=e.getHours();var i=e.getMinutes();var s=e.getSeconds();var o=(r<10?"0"+r:r)+":"+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s);return{raw:t+"T"+o,display:n+" "+o}},parseStartDate:function(e){"use strict";if(typeof e!=="undefined"&&e.length>0&&typeof e[0].date!=="undefined"){var t=this.parseDate(e[0].date);if(t){return t}}return new Date},parseDate:function(e,t){"use strict";var n=t===true?this.config.dateFormatDisplay:this.config.dateFormat;try{return $.datepicker.parseDateTime(n,this.config.timeFormat,e,null,{separator:"T"})}catch(r){console.log("Cannot parse date: "+e);return null}},getStartDate:function(){"use strict";if(typeof this.config.startDateFieldSelector!=="undefined"&&this.config.startDateFieldSelector!==""){var e=this.config.editable?$(this.config.startDateFieldSelector).val():$(this.config.startDateFieldSelector).text();if(typeof e!=="undefined"&&e!==""){try{return $(this.config.startDateFieldSelector).datepicker("getDate")}catch(t){console.log("error calculating dates: "+t.message)}}}return null},setStartDate:function(e){"use strict";if(typeof this.config.startDateFieldSelector!=="undefined"&&this.config.startDateFieldSelector!==""){var t=this.formatDate(e);if(this.config.editable){$(this.config.startDateFieldSelector).val(t.display).data("profile-date",t.raw)}else{$(this.config.startDateFieldSelector).text(t.display).data("profile-date",t.raw)}}},selectAll:function(e){"use strict";window.setTimeout(function(){var t,n;if(window.getSelection&&document.createRange){n=document.createRange();n.selectNodeContents(e);t=window.getSelection();t.removeAllRanges();t.addRange(n)}else if(document.body.createTextRange){n=document.body.createTextRange();n.moveToElementText(e);n.select()}},1)},getProfileData:function(){"use strict";var e=[];var t=this;$(this.rowsSelector).each(function(){e[e.length]={days:$(this).find("td.profileDays").text(),temperature:$(this).find("td.profileTemp").text(),date:$(this).find("td.profileDate").data("profileDate")};if(t.config.editable&&e[e.length-1].days===""){e.pop()}});return e},hasInvalidDayCells:function(){"use strict";var e=this;var t=0;var n=null;$(this.rowsSelector).each(function(){n=$(this).find("td.profileDays");if(!e.isValidCell(n)){t++}});if(n!==null){if(n.text().length===0){t--}}return t>0},toJSON:function(){"use strict";return{name:this.profileName,profile:this.getProfileData()}},toCSV:function(e,t){"use strict";var n="";var r=t||this.csvColumns;if(e){for(var i=0;i<r.length;i++){n+=(i!==0?",":"")+r[i]}n+="\n"}var s=this.getProfileData();for(var o=0;o<s.length;o++){var u=s[o];for(var a=0;a<r.length;a++){n+=(a!==0?",":"")+u[r[a]]}n+="\n"}return n},toXML:function(){},getProfileDuration:function(){"use strict";var e=this.getProfileData();for(var t=e.length-1;t>=0;t--){var n=parseFloat(e[t].days);if(!isNaN(n)){return n}}return 0},isValidCell:function(e){"use strict";var t=e.text();return typeof t!=="undefined"&&t!==""&&!isNaN(parseFloat(t))},markInvalidCells:function(){"use strict";this.preventFocusEvents=true;$(this.rowsSelector).each(function(){var e=$(this).find("td.profileDays");if(isNaN(parseFloat(e.text()))){$(this).addClass("error");e.focus();return false}else{$(this).removeClass("error")}});this.preventFocusEvents=false},resetInvalidCells:function(){"use strict";$(this.rowsSelector+".error").removeClass("error")},maintainEmptyRow:function(){"use strict";if(this.config.editable){var e=this.getProfileData();var t=e.length;var n=$(this.rowsSelector).length;if(n===t){this.addRow()}}}}